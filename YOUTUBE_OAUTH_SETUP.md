# ✅ YouTube OAuth設定ガイド

**日時**: 2025年11月9日 11:07 UTC  
**ステータス**: ✅ 正しいトークンが取得できました

---

## 🎯 提供されたトークン情報

### ✅ 完璧なスコープ！

```json
{
  "access_token": "ya29.a0ATi6K2seI-ayLlHvU...",
  "refresh_token": "1//04NPw_ZNaArWfCgYI...",
  "scope": "https://www.googleapis.com/auth/youtube",  // ✅ 完璧！
  "token_type": "Bearer",
  "expires_in": 3599
}
```

**重要**: スコープが`youtube`（フルアクセス）です。これは**`youtube.upload`を含みます**！

---

## 📋 アプリへの設定手順

### ステップ1: アプリにアクセス

**https://3000-iukw9njrdih7jga4yuix6-02b9cc79.sandbox.novita.ai**

### ステップ2: API設定ページを開く

1. 画面上部のナビゲーションメニュー
2. **「API設定」**をクリック

### ステップ3: YouTube API設定を展開

「YouTube API 設定」セクションを見つけて展開

### ステップ4: 以下の情報を入力

**Client ID** (既存の場合はそのまま):
```
407408718192.apps.googleusercontent.com
```

**Client Secret** (既存の場合はそのまま):
```
************
```

**Access Token** (新しく入力):
```
ya29.a0ATi6K2s... (前回提供されたAccess Tokenをここに入力してください)
```

**Refresh Token** (新しく入力):
```
1//04NPw_ZNaAr... (前回提供されたRefresh Tokenをここに入力してください)
```

### ステップ5: 保存

**「保存」**ボタンをクリック

---

## ✅ トークンの検証

### スコープの確認

以前のトークン:
- ❌ `youtube.readonly` （読み取り専用）
- ❌ アップロード不可

新しいトークン:
- ✅ `youtube` （フルアクセス）
- ✅ `youtube.upload`を含む
- ✅ アップロード可能！

### 権限の比較

| 操作 | youtube.readonly | youtube (full) |
|------|-----------------|----------------|
| チャンネル情報取得 | ✅ | ✅ |
| 動画一覧取得 | ✅ | ✅ |
| 動画アップロード | ❌ | ✅ |
| 動画削除 | ❌ | ✅ |
| 動画編集 | ❌ | ✅ |

---

## 🧪 テスト手順

### ステップ1: トークンを設定

上記の手順に従ってトークンを設定

### ステップ2: 動画を生成

1. **トピック**: テスト動画
2. **動画の長さ**: 10秒
3. **言語**: 日本語
4. **タイトル背景画像**: 桜の窓辺
5. **YouTube公開設定**: 非公開 (Private)
6. **生成開始**: 「🎥 動画生成を開始」

### ステップ3: YouTubeアップロードを確認

生成完了後、以下を確認：

**成功時**:
- ✅ 「✅ YouTubeにアップロードしました」メッセージ
- ✅ YouTubeリンクが表示される
- ✅ リンクをクリックするとYouTube動画が表示される

**失敗時** (まだ401エラーが出る場合):
- バックエンドログを確認
- トークンが正しく保存されているか確認
- アプリを再読み込みして再試行

---

## 🐛 トラブルシューティング

### 問題1: まだ401エラーが出る

**原因**: トークンが正しく保存されていない

**解決策**:
1. ブラウザのキャッシュをクリア
2. アプリをリロード
3. トークンを再入力
4. 保存を確認

### 問題2: トークンが期限切れになった（1時間後）

**原因**: Access Tokenの有効期限は約1時間

**解決策**:
- **Refresh Tokenは長期間有効**（無期限）
- アプリが自動的にRefresh Tokenを使ってAccess Tokenを更新します
- 特に何もする必要はありません

### 問題3: Refresh Tokenが無効になった

**原因**: 
- Googleアカウントのパスワード変更
- OAuth同意画面で権限を取り消した
- 長期間使用されなかった

**解決策**:
1. OAuth 2.0 Playgroundに戻る
2. 再度認証
3. 新しいトークンを取得
4. アプリに再設定

---

## 📊 トークン情報の詳細

### Access Token

**値**: `ya29.a0ATi6K2seI-ayLlHvU...` (206文字)

**用途**:
- APIリクエストに使用
- Bearer認証ヘッダーに含める
- 短期間有効（約1時間）

**形式**:
```
Authorization: Bearer ya29.a0ATi6K2seI-ayLlHvU...
```

### Refresh Token

**値**: `1//04NPw_ZNaArWfCgYI...` (103文字)

**用途**:
- Access Tokenの更新に使用
- 長期間有効（無期限、revoke されない限り）
- セキュアに保存する必要がある

**動作**:
```javascript
// Access Tokenが期限切れになったら
const response = await oauth2Client.refreshAccessToken();
// 新しいAccess Tokenを取得
const newAccessToken = response.credentials.access_token;
```

---

## 🔐 セキュリティ上の注意

### トークンの保護

1. **絶対に公開しない**
   - GitHub、フォーラム、SNSに投稿しない
   - スクリーンショットを共有しない

2. **定期的に確認**
   - Googleアカウントのセキュリティ設定
   - 「サードパーティのアクセス」を確認

3. **不要になったら削除**
   - 使用しなくなったら権限を取り消す
   - https://myaccount.google.com/permissions

### スコープの最小化

今回は`youtube`（フルアクセス）を使用していますが、本番環境では：

- アップロードのみ必要 → `youtube.upload`
- 読み取りのみ必要 → `youtube.readonly`
- 編集も必要 → `youtube`

必要最小限のスコープを使用することを推奨します。

---

## ✅ 成功判定基準

### トークン設定が成功 ✅
1. ✅ API設定ページでトークンを入力できる
2. ✅ 保存が成功する
3. ✅ エラーメッセージが表示されない

### YouTubeアップロードが成功 ✅
1. ✅ 動画生成が完了する
2. ✅ 「YouTubeにアップロードしました」メッセージ
3. ✅ YouTubeリンクが表示される
4. ✅ 401エラーが出ない

### YouTube動画が確認できる ✅
1. ✅ YouTubeリンクをクリック
2. ✅ 動画が再生される
3. ✅ 公開設定が正しい（Private/Unlisted/Public）
4. ✅ タイトルと説明文が設定されている

---

## 🎉 まとめ

### ✅ 提供されたトークン
- ✅ Access Token: 正しい形式
- ✅ Refresh Token: 正しい形式
- ✅ Scope: `youtube`（フルアクセス、upload含む）
- ✅ すべて完璧！

### 🚀 次のステップ
1. **アプリにトークンを設定**
2. **動画を生成してテスト**
3. **YouTubeアップロードを確認**

### 🎯 期待される結果
- ✅ YouTubeへの自動アップロードが動作
- ✅ 401エラーが解消
- ✅ 生成された動画がYouTubeに表示される

---

**作成日時**: 2025年11月9日 11:07 UTC  
**トークン有効期限**: Access Token: 約1時間、Refresh Token: 無期限  
**次のアクション**: アプリでトークンを設定してテスト
